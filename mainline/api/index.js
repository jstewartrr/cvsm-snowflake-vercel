import snowflake from 'snowflake-sdk';

const getConn = () => snowflake.createConnection({
  account: process.env.SNOWFLAKE_ACCOUNT,
  username: process.env.SNOWFLAKE_USER,
  password: process.env.SNOWFLAKE_PASSWORD,
  warehouse: process.env.SNOWFLAKE_WAREHOUSE,
  database: process.env.SNOWFLAKE_DATABASE,
  schema: process.env.SNOWFLAKE_SCHEMA,
  role: process.env.SNOWFLAKE_ROLE
});

export default async function handler(req, res) {
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');
  
  if (req.method === 'OPTIONS') return res.status(200).end();
  
  if (req.method === 'GET') {
    return res.json({
      service: 'CV-SF-Mainline-Snowflake-MCP',
      version: '1.0.0',
      status: 'healthy',
      region: process.env.VERCEL_REGION || 'unknown'
    });
  }
  
  const {sql} = req.body || {};
  if (!sql) return res.status(400).json({error: 'Missing sql parameter'});
  
  try {
    const conn = getConn();
    const result = await new Promise((resolve, reject) => {
      conn.connect((err, c) => {
        if (err) return reject(err);
        c.execute({
          sqlText: sql,
          complete: (err, stmt, rows) => {
            c.destroy();
            if (err) return reject(err);
            resolve({
              columns: stmt.getColumns().map(col => col.getName()),
              rows: rows,
              rowCount: rows.length
            });
          }
        });
      });
    });
    return res.json({success: true, ...result});
  } catch (e) {
    return res.status(500).json({success: false, error: e.message});
  }
}
